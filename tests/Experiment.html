<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" href="../css/jspsych.css">

    <!-- jQuery first, then Bootstrap JS. -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
            integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <!-- Then jsPsych -->
    <script src="../jspsych.js"></script>

    <!-- Plugins -->
    <script src="../plugins/pcllab-study-text.js"></script>
    <script src="../plugins/pcllab-short-answer.js"></script>
    <script src="../plugins/pcllab-demographics.js"></script>
    <script src="../plugins/pcllab-instructions.js"></script>
    <script src="../plugins/pcllab-debrief.js"></script>
    <script src="../plugins/jspsych-survey-multi-choice.js"></script>
    <script src="../plugins/jspsych-call-function.js"></script>


    <title>Experiment</title>
</head>
<body>
<div id="experiment_container" class="container-fluid"></div>
</body>

<script>

    var timeline = [];
    var urlVars = jsPsych.data.urlVariables();
    var workerId = urlVars.workerId;
    var condition = urlVars.condition;

     var study1 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label1"
    };

    var page_1_questions = ["<font size =5>Was you answer correct, partially correct, or incorrect?</font size =5>"];


    var page_1_options = ["<font size =4> Correct</font size =4", "<font size =4> Partially Correct</font size =4>", "<font size =4> Incorrect</font size =4>"];

    var instructions1 = {
        type: 'pcllab-instructions',
        label: 'General'

    };

    var instructions2 = {
        type: 'pcllab-instructions',
        label: 'Study'
    };

    var instructions3 = {
        type: 'pcllab-instructions',
        label: 'Recall'
    };

    var instructions4 = {
        type: 'pcllab-instructions',
        label: 'Mixed_Scoring'
    };

    var instructions5 = {
        type: 'pcllab-instructions',
        label: 'Blocked_Scoring'
    };

    var instructions6 = {
        type: 'pcllab-instructions',
        label: 'Finish'
    };

     var debrief = {
        type: 'pcllab-debrief',
        label: 'Debrief'
    };

    var study2 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label2"
    };

    var study3 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label3"
    };

    var study4 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label4"
    };

    var study5 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label5"
    };

    var study6 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label6"
    };

    var study7 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label7"
    };

    var study8 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label8"
    };

    var study9 = {
        type: 'pcllab-study-text',
        minimum_time: 1000 * 1,
        label: "label9"
    };

    var retrieve1 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label1"
    }; 

     var retrieve2 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label2"
    }; 

     var retrieve3 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label3"
    }; 

     var retrieve4 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label4"
    }; 

     var retrieve5 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label5"
    }; 

     var retrieve6 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label6"
    }; 

     var retrieve7 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label7"
    }; 

     var retrieve8 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label8"
    }; 

     var retrieve9 = {
        type: 'pcllab-short-answer',
        minimum_time: 1000 * 1,
        show_progress: false,
        label: "label9"
    }; 

    var demographics = {
        type: "pcllab-demographics"
    };

    var grade_deltoid1 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Deltoid Muscle -- Function </center></p> <p> <b><font size =5>Correct Answer:</b> Functions to move the upper arm away from the body</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
      var grade_deltoid2 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Deltoid Muscle -- Innervation </center></p> <p> <b><font size =5>Correct Answer:</b> Is stimulated by the axillary nerve</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_deltoid3 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Deltoid Muscle -- Location </center></p> <p><b><font size =5>Correct Answer:</b> Resides on the side of the upper arm at the shoulder</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_digital1 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Digital Flexor Muscles -- Function </center></p> <p> <b><font size =5>Correct Answer:</b> Function together to flex the fingers</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_digital2 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Digital Flexor Muscles -- Innervation </center></p> <p> <b><font size =5>Correct Answer:</b> Are stimulated by the median and ulnar nerves</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_digital3 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Digital Flexor Muscles -- Location </center></p><p><b><font size =5>Correct Answer:</b> Reside on the front of the forearm when the palm is facing forward</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_triceps1 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Triceps Muscle -- Function </center></p> <p> <b><font size =5>Correct Answer:</b> Functions to extend the lower arm at the elbow</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_triceps2 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Triceps Muscle -- Innervation </center></p> <p> <b><font size =5>Correct Answer:</b> Is stimulated by the radial nerve</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_triceps3 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData();
      return "<font size =5><p><center>Triceps Muscle -- Location </center></p> <p> <b><font size =5>Correct Answer:</b> Resides on the back of the arm</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };

      function getSubjectData() {

    var trials = jsPsych.data.getLastTrialData();

    return trials.short_answer_response
  }

  var grade_deltoid11 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData1();
      return "<font size =5><p><center>Deltoid Muscle -- Function </center></p> <p> <b><font size =5>Correct Answer:</b> Functions to move the upper arm away from the body</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
      var grade_deltoid21 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData2();
      return "<font size =5><p><center>Deltoid Muscle -- Innervation </center></p> <p> <b><font size =5>Correct Answer:</b> Is stimulated by the axillary nerve</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_deltoid31 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData3();
      return "<font size =5><p><center>Deltoid Muscle -- Location </center></p> <p><b><font size =5>Correct Answer:</b> Resides on the side of the upper arm at the shoulder</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_digital11 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData4();
      return "<font size =5><p><center>Digital Flexor Muscles -- Function </center></p> <p> <b><font size =5>Correct Answer:</b> Function together to flex the fingers</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_digital21 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData5();
       return "<font size =5><p><center>Digital Flexor Muscles -- Innervation </center></p> <p> <b><font size =5>Correct Answer:</b> Are stimulated by the median and ulnar nerves</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_digital31 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData6();
      return "<font size =5><p><center>Digital Flexor Muscles -- Location </center></p><p><b><font size =5>Correct Answer:</b> Reside on the front of the forearm when the palm is facing forward</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_triceps11 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData7();
      return "<font size =5><p><center>Triceps Muscle -- Function </center></p> <p> <b><font size =5>Correct Answer:</b> Functions to extend the lower arm at the elbow</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_triceps21 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData8();
      return "<font size =5><p><center>Triceps Muscle -- Innervation </center></p> <p> <b><font size =5>Correct Answer:</b> Is stimulated by the radial nerve</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };
        var grade_triceps31 = {
      type: 'survey-multi-choice',
      questions: page_1_questions,
      options: [page_1_options], 
      preamble: function() {
      var subject_data = getSubjectData9();
      return "<font size =5><p><center>Triceps Muscle -- Location </center></p> <p> <b><font size =5>Correct Answer:</b> Resides on the back of the arm</font size =5></p><b>Your Answer:</b> " +  subject_data + "<p></p></font size =5>"
      }
      };

      // This needs to be called somewhere on your timeline before the save_data_block.
  var save_function = {
  type: 'call-function',
  timing_post_trial: 0,
  func: function saveMySQL(data){
   var data_table = "Delayed_Self_Scoring"; // change this for different experiments
   $.ajax({
      type:'post',
      cache: false,
      url: 'savedata.php', // change this to point to your php file.
      // opt_data is to add additional values to every row, like a subject ID
      // replace 'key' with the column name, and 'value' with the value.
      data: {
          table: data_table,
          json: JSON.stringify(data),
          // opt_data: {key: value}
      },
      success: function(output) { console.log(output); } // write the result to javascript console
   });
}
// This will save the data to a CSV file in the experiment directory. This only works on your machine if you are running MAMP.
function saveCSV(filename, filedata){
  $.ajax({
    type:'post',
    cache: false,
        url: 'save_csv.php', // this is the path to the above PHP script
        data: {filename: filename, filedata: filedata}
    });
}

  // Add this to your timeline after the exit survey, but before the debriefing.
var save_data_block = {
  type: 'call-function',
  timing_post_trial: 0,
  func: function(){
    jsPsych.data.addProperties({completed: true}), 
    // saveCSV("filename.csv", jsPsych.data.dataAsCSV()),
    saveMySQL(jsPsych.data.getData()) //Need to edit table name in function.
    // jsPsych.data.displayData();
  }
};

      function getSubjectData1() {

    var trials1 = jsPsych.data.getDataByTrialIndex(13);

    return trials1.short_answer_response
  }

     function getSubjectData2() {

    var trials2 = jsPsych.data.getDataByTrialIndex(14);

    return trials2.short_answer_response
  }

     function getSubjectData3() {

    var trials3 = jsPsych.data.getDataByTrialIndex(15);

    return trials3.short_answer_response
  }

     function getSubjectData4() {

    var trials4 = jsPsych.data.getDataByTrialIndex(16);

    return trials4.short_answer_response
  }

     function getSubjectData5() {

    var trials5 = jsPsych.data.getDataByTrialIndex(17);

    return trials5.short_answer_response
  }

     function getSubjectData6() {

    var trials6 = jsPsych.data.getDataByTrialIndex(18);

    return trials6.short_answer_response
  }

     function getSubjectData7() {

    var trials7 = jsPsych.data.getDataByTrialIndex(19);

    return trials7.short_answer_response
  }

     function getSubjectData8() {

    var trials8 = jsPsych.data.getDataByTrialIndex(20);

    return trials8.short_answer_response
  }

     function getSubjectData9() {

    var trials9 = jsPsych.data.getDataByTrialIndex(21);

    return trials9.short_answer_response
  }

      //Mixed condition

       if (condition == '1') {

      timeline.push(demographics, instructions1, instructions2, study1, study2, study3, study4, study5, study6, study7, study8, study9, instructions3, instructions4, retrieve1, grade_deltoid1, retrieve2, grade_deltoid2, retrieve3, grade_deltoid3, retrieve4, grade_digital1, retrieve5, grade_digital2, retrieve6, grade_digital3, retrieve7, grade_triceps1, retrieve8, grade_triceps2, retrieve9, grade_triceps3, save_function, save_data_block, instructions6, debrief);

      //Blocked Condition

        } else if (condition == '2') {

        timeline.push(demographics, instructions1, instructions2, study1, study2, study3, study4, study5, study6, study7, study8, study9, instructions3, retrieve1, retrieve2, retrieve3, retrieve4, retrieve5, retrieve6, retrieve7, retrieve8, retrieve9, instructions5, grade_deltoid11, grade_deltoid21, grade_deltoid31, grade_digital11, grade_digital21, grade_digital31, grade_triceps11, grade_triceps21, grade_triceps31, save_function, save_data_block, instructions6, debrief);
        }

    jsPsych.init({
        display_element: $("div#experiment_container"),
        timeline: timeline,
        on_finish: function () {
            jsPsych.data.displayData();
        }
    })
</script>
</html>